
# üôãüõúüö¶`802.11k/v/r` - `RRM` / `WNM` / `FT`

![My Video](https://user-images.githubusercontent.com/94720207/165892585-b830998d-d7c5-43b4-a3ad-f71a07b9077e.gif)

### üê¶ Twitter  : [@fz3r0_OPs](https://twitter.com/Fz3r0_OPs)
### üê± Github  : [Fz3r0](https://github.com/fz3r0) 

---
 
#### Keywords: `Networking` `Wireless Networking` `IEEE 802.11` `Wi-Fi` `CWNA` `CWAP` `CWNE` `CCNP` `MAC Operations` `802.11k/v/r` `802.11k` `802.11v` `802.11r` `RRM` `WNM` `FT`

---

<br>

# Index



# `802.11k/v/r` - `RRM` / `WNM` / `FT`

- `802.11k - Radio Resource Measurement (RRM)`
- `802.11v - Wireless Network Management (WNM)`
- `802.11r - Fast Transition (FT)`

# 802.11k/v/r: Relationship

802.11k, 802.11r, and 802.11v are integral in improving the the experience of 802.11 (Wi-Fi) client STAs, **specifically around mobility and roaming** _(+ other features in addition of roaming, like band balancing, load balancing, and more...)_. 

- `802.11k` - `Radio Resource Management (RRM)` :: `{assisted roaming - [neighbor req/res]}` :: **INFORMS** client STAs for roaming decisions via **Assisted Roaming** through **neighbor requests/responses**, helping the client make informed roaming decisions. <br><br>
- `802.11v` - `Wireless Network Management (WNM)` :: `{BSS Transition - [BSS Transition Management req/res]}` :: **MANAGE** the client STA roaming via **BSS Transition Management** through **BSS Transition Management requests/responses**. Here, the **AP uses information from 802.11k (RRM)** to guide the client‚Äôs roaming. <br><br>
- `802.11r` - `Fast Transition (FT)` :: If used alongside `802.11k/v (RRM & WNM)` :: In addition to the benefits of 802.11k and 802.11v, the `client STA can roam in under 50 ms` **(useful for VoIP networks)** if using 802.1X EAP. In this case, the client STA only needs the 4-way handshake, with no full EAP exchange required.

**`Important`:** In WPA2-PSK networks, 802.11r (FT) is generally unnecessary since this type of RSNA does not need to contact a RADIUS server externally. In this setup, roaming between APs and STAs using the 4-way handshake already occurs within 50 ms or less.









# `802.11k - Radio Resource Measurement (RRM)`

**IEEE 802.11k-2008** is an amendment to IEEE 802.11-2007 standard for `Radio Resource Measurement (RRM)`. It is also known for `802.1k Assisted Roaming` purposes _(but is not the only one_. It enables 802.11k capable client‚Äôs radio to better understand the RF environment that they exist which will help clients to have better roaming.

- **802.11k (RRM)** defines and exposes **radio and network information** to **facilitate the management and maintenance of a WLAN using 802.11v (WNM)**
- **802.11k (RRM)** and **802.11r (Fast Roaming)** are industry standards that enable seamless BSS transitions (known as "roaming") in the WLAN environment. **The 802.11k standard provides information to discover the best available AP**.
- **802.11k  (RRM)** inform client STAs of the WLAN RF information such as the AP **Channel**, **RSSI**, **Neighbor BSSID**, etc.
- **Neighbor Report Requests (Action)** & **Neighbor Report Responses (Action)** exchange this info between STAs and APs, that's why those action frames are tipically used in 802.11k. 

802.11k allows client STAs to make more informed roaming decisions, hence called "AP Assisted Roaming". Ultimately, **client STAs still make the final roaming decision.**  

- `Important`: Using **`802.11k` together with `802.11v`, the overall network performance can significantly increase, especially if the client STA is associated with FT, offered by `802.11r` (Fast Transition). That's why a lot of times the 3 different amendments are used together as: `802.11k/v/r`.**

## 802.11k Measurements

802.11k describes the following measurements:

- Beacon
- Frame
- Channel Load
- Noise Histogram
- STA Statistics
- Location Configuration Information
- Neighbor Report
- Link Measurement
- Transmit Stream/Category Measurement

## 802.11k `benefits` 

### Improved Roaming

- Allows the devices to roam efficiently and quickly

### Speeds up scanning & no off-channel scanning needed

- No need to probe all of the 2.4 GHz and 5 GHz channels to find an access point suitable for roaming
- Instead of the client engaging in time consuming scanning activity (either actively probing for APs or passively listening to every channel for beacons) the client can instead narrow its list down to the known available neighbors.
- This is especially useful in high density environments where multiple WLANs can be heard by the client

### Reduces client power consumption

- Increases devices' battery life, not having to change the radio configuration for each channel and send requests on each channel
- The time taken by scanning (especially active scanning) also consumers battery power for the client. Since the **neighbor report provides information before roaming**, **less power may be consumed**.

### More efficient use of WLAN airtime

- Not having to probe all of the channels reduces channel utilization on all channels, increasing the available bandwidth on all channels
- Active scanning is not only time consuming from the perspective of client resources (cpu, memory, radio, etc.), it‚Äôs also ‚Äúair time‚Äù consuming. For example, a client that is not neighbor aware will likely engage in so-called wildcard probe requests (some clients will burst these). 
- In this scenario, typically every AP that hears the probe request will generate a probe response. 
- In other words, for a single client, a number N of APs will generate N probe responses. 
- If multiple clients engage in wildcard probing, then the RF environment can quickly become ‚Äúpolluted‚Äù with management traffic simply because the clients are not using neighbor request. This has a negative impact for the entire WLAN

## 802.11k: `RRM Information Element`

If RRM is enabled and/or capable by the AP or client STA, the RRM Information Element can be present in:

- Beacon _(AP)_
- Probe Request _(STA)_
- Probe Response  _(AP)_
- Authentication Request _(STA)_
- Authentication Response  _(AP)_
- Re-Authentication Request _(STA)_
- Re-Authentication Response  _(AP)_

## 802.11k: `Wireshark Filters`


- Neighbor Request & Response:  `wlan.fixed.action_code in {0x04,0x05}`
- ACtion: Neigboir Reqeust: `wlan.fixed.action_code == 4`
- ACtion: Neigboir Reqeust filtering by SSID: `wlan.fixed.action_code == 4 && wlan.ssid == "Fz3r0::CWAP"`
- ACtion: Neigboir Response: `wlan.fixed.action_code == 5`
- ACtion: Neigboir Response filtering by BSSID: `wlan.nreport.bssid == f0:f0:f0:f0:f0:f0`
- RRM IE Tag number (all frames conaining RRM IE): `wlan.tag.number == 70`
- RM Enables Capabilites: in Beacon -
- RM Enables Capabilites: in Probe Request -
- RM Enables Capabilites: in Probe Response -
- RM Enables Capabilites: in Authentication Request -
- RM Enables Capabilites: in Authentication Response -
- RM Enables Capabilites: in Re-Authentication Request -
- RM Enables Capabilites: in Re-Authentication Response -

If there is no** RM Enabled Capability Information Element (IE)** then **802.11k is NOT enabled on that SSID**. If it is there then I think you can safely assume 802.11k is supported, but more specifically you can check to see if Neighbor Reports is Enabled under the first RM Capabilities octet:

### Action Frame: `Radio Resource Measurement`:`Neighbor Request` _(From: STA | To: AP)_

`Neighbor Request (Action Frames)`: **Client STAs ask** for specific SSID info in Neigbor Requests.

````
# Action Frame > Radio Resource Measurement > Neighbor Request
# 802.11k - RRM

802.11 radio information
IEEE 802.11 Action, Flags: ........
    Type/Subtype: Action (0x000d)
    Frame Control Field: 0xd000

    Destination address: AP1_f0:f0:f0 (AP1_f0:f0:f0)
    Transmitter address: Alice_a1:a1:a1 (Alice_a1:a1:a1)
    BSS Id: AP1_f0:f0:f0 (AP1_f0:f0:f0)

IEEE 802.11 Wireless Management

    Fixed parameters
        Category code: Radio Measurement (5)
        Action code: Neighbor Report Request (4)
        Dialog token: 21

    Tagged parameters (13 bytes)
        Tag: SSID parameter set: "Fz3r0::CWAP"
                                  
            Tag Number: SSID parameter set (0)
            Tag length: 11
            SSID: "Fz3r0::CWAP"

````


### Action Frame: `Radio Resource Measurement`:`Neighbor Response` _(From: AP | To: STA)_

`Neighbor Reports (Action Frames)`: **APs inform** client STAs of BSSID RF Conditions.

````sh
# Action Frame > Radio Resource Measurement > Neighbor Response
# 802.11k - RRM

802.11 radio information
IEEE 802.11 Action, Flags: ........
    Type/Subtype: Action (0x000d)
    Frame Control Field: 0xd000

    Transmitter address: AP1_f0:f0:f0 (AP1_f0:f0:f0)
    BSS Id: AP1_f0:f0:f0 (AP1_f0:f0:f0)

IEEE 802.11 Wireless Management

    Fixed parameters
        Category code: Radio Measurement (5)
        Action code: Neighbor Report Response (5)
        Dialog token: 21

    Tagged parameters (161 bytes)
        Tag: Neighbor Report
            Tag Number: Neighbor Report (52)
            Tag length: 21
            BSSID: AP2_f2:f2:f2 (AP2_f2:f2:f2)
            BSSID Information: 0x0000dc97
                .... .... .... .... .... .... .... ..11 = AP Reachability: Reachable (0x3)
                .... .... .... .... .... .... .... .1.. = Security: True
                .... .... .... .... .... .... .... 0... = Key Scope: False
                .... .... .... .... .... ..00 1001 .... = Capability: 0x09
                .... .... .... .... .... .1.. .... .... = Mobility Domain: True
                .... .... .... .... .... 1... .... .... = High Throughput Control (+HTC): True
                .... .... .... .... ...1 .... .... .... = Very High Throughput (+VHT): True
                .... .... .... .... ..0. .... .... .... = Fine Timing Measurement (FTM): False
                .... .... .... .... .1.. .... .... .... = High Efficiency (HE AP): True
                .... .... .... .... 1... .... .... .... = Extended Range BSS: True
                .... .... .... ...0 .... .... .... .... = Co-Located AP: False
                .... .... .... ..0. .... .... .... .... = Unsolicited Probe Responses Active: False
                .... .... .... .0.. .... .... .... .... = Members Of ESS With 2.4/5 GHz Co-Located AP: False
                .... .... .... 0... .... .... .... .... = OCT Supported With Reporting AP: False
                .... .... ...0 .... .... .... .... .... = Co-Located With 6 GHz AP: False
                .... .... ..0. .... .... .... .... .... = Extremely High Throughput: False
                0000 0000 00.. .... .... .... .... .... = Reserved: 0x000
            Operating Class: 121
            Channel Number: 100 (iterative measurements on that Channel Number)
            PHY Type: 0x0e
            Subelement: Wide Bandwidth Channel
                ID: 6
                Length: 3
                Data: 006400
            Subelement: BSS Transition Candidate Preference
                ID: 3
                Length: 1
                Preference: 0
````






## RRM: Frame exchange

1. `Neighbor Request (Action Frames)`: **Client STAs ask** for specific SSID info in Neigbor Requests.
2. `Neighbor Reports (Action Frames)`: **APs inform** client STAs of BSSID RF Conditions.




## RRM: Wireshark Filters







## 802.11k: `Assisted Roaming`

**802.11k**, is also known as **Assisted Roaming**, it improves network performance by helping client STAs to faster search the nearest AP available based on its active users and overall traffic.

**802.11k assists client STAs in identifying nearby APs using `Neighbor Reports`**, **minimizing the need for off-channel scanning** during the decision-making process of which AP to roam to next. 

- **Any time when necessary, the client STA can request a neighbor report to the AP, that provides a list of nearby APs (Most of the times, STA will send a neighbor request everytime associates to an AP).**

This standard improves network performance by helping client devices to search faster the nearest AP available, based on its active users and overall traffic. The client devices continuously scan the nearestAP and their channels. Also, it provides optimized signal strength management while decreasing the amount of time needed to find neighboring APs. In this way, the end-user has a better roaming experience.

Devices which support this standard (e.g. more recent smartphones) can send a request to obtain a list of neighbor access points, with their channels and status, for instance when the signal strength of the current one starts weakening.

Once obtained, the devices know which APs are candidates for the next roam.

**This standard specifies:**

- **If there's an `close AP (AP-1) with high traffic`, and another `AP (AP-2) with less traffic but farther` than the first one, the recommended one will be `AP-2`, due to its faster `throughput capability`.**
- **In the case, the signal strength of the current `AP-2` debilitates, the client STA immediately finds another AP from the network list**.

Using **`802.11k` together with `802.11v`, the overall network performance can significantly increase, especially if the client STA is associated with FT, offered by `802.11r` (Fast Transition). That's why a lot of times the 3 different amendments are used together as: `802.11k/v/r`.**




## 802.11k: `Frame Exchange`

_In this frame exchange example 802.11k will be used for roaming from AP-1 to AP-2_

**802.11k assists client STAs in identifying nearby APs**, minimizing the need for off-channel scanning during the decision-making process of which AP to roam to next. When necessary, the client can request a neighbor report that provides a list of nearby APs.

**802.11k** is used within **802.11r** that improves roaming efficiency in Wi-Fi networks, enabling client STAs to identify nearby APs without conducting a full channel scan, thereby reducing disconnection time and enhancing mobility experience.

#### 1. Roaming Scenario Initiation

- The client STA detects that the signal quality with the current AP has degraded, either due to distance or interference.
- To optimize the transition to a neighboring AP without performing a complete manual channel scan, the STA considers requesting a Neighbor Report from the current AP.

#### 2. Neighbor Report Request:

- The client STA sends a specific 802.11k Action Frame to the AP, with a subfield indicating a Neighbor Report Request.
- This formal request allows the AP to prepare and provide a list of neighboring APs that meet specific criteria (e.g., same ESSID and available for roaming).
- This step prevents the client from having to scan all channels, which can interrupt data flow.

#### 3. AP Response with Neighbor Report

- After receiving the STA‚Äôs request, the AP reviews its configured neighbor list and responds with a Neighbor Report Response, containing a list of recommended neighboring APs.
- Each entry in the neighbor report includes the MAC address of neighboring APs, their channels, and other relevant information for roaming, such as the availability of 802.11r (Fast Transition).

#### 4. Client STA Evaluation:

- The client STA analyzes the received list of neighboring APs and determines which AP has the best characteristics for roaming.
- Based on signal quality and other parameters, it decides on the next AP to attempt a connection with, reducing the need for active scanning across all channels.

#### 5. Roaming Process:

- Using the information provided by the Neighbor Report, the client STA selects an appropriate AP and initiates an authentication and association process with the new AP.

**If the environment also supports `802.11r - (FT - Fast Transition)`** the roaming process will be further optimized to reduce re-authentication latency:

- The `client STA` need to roam from `AP-1` to `AP-2` using **802.1X (RADIUS)** [Full Association: State Machine + EAP + 4-way-handshake].
- The `AP` can "help" the `client STA` so it can roam in less than `50ms` using 802.1r (FT): <br><br>
    - `client STA` informs `AP-2` that is coming from `AP-1` and shares its `PMKID`.
    - `client STA` use the `PMKR1` to generate the `PTK` (for the 4-way-handshake).

`Important`: **802.11r** speeds up client roaming between APs by allowing clients to **skip reauthentication with the RADIUS server (all the EAP process)**. 

- The **keys** can be exchanged `over the air` or `over the DS` (backend/backbone of the network).





















































# `802.11v - Wireless Network Management (WNM)`

IEEE 802.11v is an amendment to the IEEE 802.11 standard to allow configuration of client devices while connected to wireless networks. It was published as 802.11v-2011 and later incorporated into 802.11-2012. After several years in development as a draft standard, 802.11v was ratified as a formal amendment to the 802.11 standard on 2 February 2011. Its content was later moved to the next edition of the main standard in 802.11-2012.

**802.11v is a LAAARGE amendment, which consists of several features**, most of which were never implemented in the real world. It allows client STA devices to exchange information about the network topology, including information about the RF environment, making each client network-aware, facilitating overall improvement of the wireless network.  

- **802.11v BTM allows the AP to make solicited or unsolicited roaming recommendations to the client STA.  Which the client STA is free to ignore, and they often do.**

802.11v describes enhancements to wireless network management, such as:

### 802.11v: BSS transition management (BTM)

**This is useful for: `roaming`,  `load balancing`, `band steering` and in directing `poorly connected` clients.**

- AP can suggest its connected client to roam to another AP with a better network condition with BTM frame exchange.
- Its up to the client to owner the request or not.
- In case client doesn‚Äôt roam AP will disconnect the client forcefully if disassociate-imminent is enabled after expiry of time period configured.
- It can be understand from series of frame exchanges.

### 802.11v: Network Assisted Roaming (802.11k + 802.11v)

**This is useful for: `roaming`**

- Enables the WLAN to send messages to associated clients, for better APs to associate with clients. 

### 802.11v: BSS max idle period management 

**This is useful for: `Power Saving`

- When client is idle and not sending any frames to AP.
- Its the amount of time an AP will keep client in associated state.
- Client can remain sleep to save battery power.
- The time period can be seen in association and re-association response frames.

### 802.11v: Network Assisted Power Savings 

**This is useful for: `Power Saving`

- Helps clients to improve battery life by enabling them to sleep longer.
- For example, mobile devices use a certain amount of idle period to ensure that they remain connected to access points and therefore consume more power when performing the following tasks in a wireless network.





BSS Transition Management enables an AP to request a voice client to transition to a specific AP, or suggest a set of preferred APs to a voice client, due to network load balancing or BSS termination. This helps the voice client identify the best AP to which that client should transition to as that client roams. ArubaOS supports BSS Transition Management features defined by the 802.11v standard.

The BSS Transition capability can improve throughput, data rates and QoS for the voice clients in a network by shifting (via transition) the individual voice traffic loads to more appropriate points of association within the ESS.












allows the **AP to suggest roaming decisions to clients**. These decisions are based on **load of total clients** as well as **channel conditions** supplied with **`802.11k` neighbor reports**.

What about 802.11r? Do we have the same naming confusing? Of course we do!!!

Again, the working group was 802.11r but the feature is known as ‚ÄòFast BSS Transition‚Äô or ‚ÄòFast Transition‚Äò. Cisco refer to it as ‚ÄòFast Transition‚Äô and Aruba refers to is as ‚Äò802.11r‚Äô.

So what about the beacon information element? Consistent? Similar? Nope!

The beacon IE itself is called ‚ÄúMobility Domain‚Äú. Easily confused with the very similar exactly same language used for a completely unrelated function within Cisco (to be clear, Cisco used the term before 802.11 did I believe). Once you dig into the Mobility Domain IE you will then see the terms ‚ÄòFT‚Äô and ‚ÄòFast BSS Transition‚Äô being used.

If you do not see the Mobility Domain IE then the SSID does NOT support 802.11r. If it does exist, then you need to expand out the ‚ÄòFT Capability and Policy‚Äô sub-element to identify whether the SSID is using ‚ÄòFT Over the Air‚Äô or ‚ÄòFT Over the DS‚Äô. But you won‚Äôt find two separate settings, this is a binary decision, one or the other must be used. Therefore the parameter ‚ÄòFast BSS Transition over DS‚Äô is used to indicate which it is; Enabled obviously means that Over the DS is used, and disabled can be surmised as Over The Air is used.

Here is what it looks like within Wireshark, including the sub-element identifying that the SSID uses FT ‚ÄòOver The DS‚Äô.


Here is what it looks like within Wireshark, including the sub-element identifying that the SSID uses FT ‚ÄòOver The Air‚Äô (because Over The DS is disabled).


Here is what it looks like within Omnipeek, including the sub-element identifying that the SSID uses FT ‚ÄòOver The DS‚Äô.


Here is what it looks like within Wireshark, including the sub-element identifying that the SSID uses FT ‚ÄòOver The Air‚Äô.


Hope that helps someone. As always, any comments welcome. And if you spot anything I‚Äôve got wrong please let me know!











## 802.11v frame types


BSS Transition Management uses the following frame types:

1. Query: A Query frame is sent by the voice client that supports BSS transition management requesting a BSS transition candidate list to its associated AP, if the associated AP indicates that it supports the BSS transition capability.

2. Request: An AP that supports BSS Transition Management responds to a BSS Transition Management Query frame with a BSS Transition Management Request frame. The AP may also send an unsolicited BSS Transition Management Request frame to a voice client at any time, if the client supports the BSS Transition Management capability. The Request frame also contains a Disassociation flag. If the flag is set, then the AP forcefully disassociates the client after 10 beacon intervals.

3. Response: A Response frame is sent by the voice client back to the AP, informing whether it accepts or denies the transition.




## 802.11v: Frame Exchange

802.11v:

Imagine a wireless mobile device having trouble sending or receiving data because it's too far from the access point (AP).

Access Point: Hello there, my dear mobile device. Why are you struggling here instead of moving to another AP?

Wireless Mobile: I'm just being loyal üòÖ.

Access Point: Well, keep your loyalty in your pocket. Here‚Äôs the best AP nearby for you to connect to. Go and connect, no need to struggle here.

Wireless Mobile: Hehe, thanks! Bye üëãüèª.

802.11v BSS Transition Management enables an access point (AP) to recommend or request that a device switch to a different AP, often to balance the network load or if the current AP can no longer maintain the connection. This helps the device choose the best AP from a list of suggested options. In networks where APs can talk to each other, this process becomes more dependable. APs track the device's signal strength (RSSI) using Probe requests to ensure a strong connection.



As a result, using 802.11v is more likely to disrupt network access if the behavior isn't understood with the clients you're supporting.




































# Load Balancing

Load balancing ensures that client devices are distributed evenly, so no single AP is simultaneously overloaded with too many client devices. Therefore, the total number of client devices can be served by various APs, delivering better performance and an improved user experience.

If a client device wants to connect to an access point, it sends a ‚Äúrequest of association‚Äù to the AP. If the access point is already overloaded with client devices connected, it will deny the client device‚Äôs association request. The client device then would have to resent a request of association to a nearby access point that it has more space to grant a ‚Äúroom‚Äù to the client.

A network with multiple access points shares the client devices‚Äô load information. Load balancing is a mechanism that can exist in distributed architectures in which all the access points communicate with one another. Or in a centralized architecture that uses a WLAN controller.

It optimizes throughput for all client devices by continually optimizing user associations to give each client device optimal throughput. This improves the throughput for each client device and dynamically balances the client load for the network.‚Äã

![image](https://github.com/user-attachments/assets/c87e4644-35d0-4fba-981e-dd5e30f7121a)

![image](https://github.com/user-attachments/assets/76df99ad-b5b8-4d4c-a0b6-fd9e57193ab1)

## Load Balancing Scenarios

Load balancing is an ideal setting to enable in high-density environments in which roaming is not necessary. For instance, a theatre room with multiple access points installed in the same open space. In a deployment of this type, the client device will hear all the access points and load balancing in this scenario is a must.

On the contrary, when it comes to deployments in which roaming is the star, load balancing is not the right approach as it would cause client devices to become sticky and stay associated with the access point way longer than it should. In this type of scenario, where roaming is a must, having load balancing can be detrimental for the roaming process. So be aware of the settings.

## Load Balancing: 802.11v

802.11v. Besides helping to preserve the device battery life, this standard also allows the WiFi network to influence the device‚Äôs behavior, providing the information of nearby access points (like their load), optimizing client transition to the best identified AP. Activating this capability for the ideal scenario efficiently balances the number of devices connected to an access point. It also helps to direct poorly connected devices to the best AP.

If you are a Tanaza user and would like to activate 802.11v to improve the load balance of client devices in your networks, read this article to learn how to activate 802.11v within the Tanaza platform.






# Band Steering + 802.11v

Band steering typically works as follows. When a new device connects to the network, the Access Point (AP) will determine if it is a dual-band device (2.4 GHz & 5 GHz). If so, the AP will push the device to connect to the 5 GHz band by blocking any attempt of the device to connect to the 2.4 GHz band.

How does that work?

It depends on the implementation of each vendor, but basically either the Authentication or Association messages received by the 2.4 GHz radio from the client device are ignored.

![image](https://github.com/user-attachments/assets/c90519ca-4471-48b0-aad7-9d1d37aadabb)

Ruckus Smartzone Example:

![image](https://github.com/user-attachments/assets/4118e75c-75dc-436c-b4d0-1b06240d3101)

- `Basic`: AP will push the device to connect to the 5 GHz band by blocking any attempt of the device to connect to the 2.4 GHz band.

That's the basic implementation of band steering. But what happens once the device is connected to the radio in the 05 GHz band and that device is moved around the coverage area resulting in a decreased signal strength? Each vendor decides on an algorithm to suggest the end device change to a different radio band. 

Example `Basic` + `802.11v BTM`: 

- A threshold is defined for each radio band, which is normally based either on RSSI or SNR.
- Due to the characteristics of the 2.4 GHz radio band, like better penetration, the threshold required for this radio band is usually higher.
- An algorithm like this is defined for this purpose:

![image](https://github.com/user-attachments/assets/05d39c63-3566-4fff-8037-af6df1d13876)











## Over the air present in:

Beacon
Probe Response
RSN Information Element
AKM List







## RRM: Frame exchange

Beacons

- `BSS Transition`

Filter

BTM Request and Responses:

- `wlan.fixed.action_code in {0x07,0x08}`

````sh
# Action Frame >
# 802.11v - Wireless Network Management (WNM)

Frame 33267: 133 bytes on wire (1064 bits), 133 bytes captured (1064 bits)
Radiotap Header v0, Length 48
802.11 radio information
IEEE 802.11 Action, Flags: ........
    Type/Subtype: Action (0x000d)
    Frame Control Field: 0xd000
    .000 0000 0011 1100 = Duration: 60 microseconds
    Receiver address: c2:d2:65:c2:6e:d5 (c2:d2:65:c2:6e:d5)
    Destination address: c2:d2:65:c2:6e:d5 (c2:d2:65:c2:6e:d5)
    Transmitter address: RuckusWirele_72:13:6c (54:ec:2f:72:13:6c)
    Source address: RuckusWirele_72:13:6c (54:ec:2f:72:13:6c)
    BSS Id: RuckusWirele_72:13:6c (54:ec:2f:72:13:6c)
    .... .... .... 0000 = Fragment number: 0
    0000 0000 0100 .... = Sequence number: 4
    [WLAN Flags: ........]
IEEE 802.11 Wireless Management
    Fixed parameters
        Category code: WNM (10)
        Action code: BSS Transition Management Request (7)
        Dialog token: 0x01
        .... ...1 = Preferred Candidate List Included: 1
        .... ..0. = Abridged: 0
        .... .0.. = Disassociation Imminent: 0
        .... 0... = BSS Termination Included: 0
        ...0 .... = ESS Disassociation Imminent: 0
        ..0. .... = Link Removal Imminent: 0
        10.. .... = Reserved: 0x2
        Disassociation Timer: 0
        Validity Interval: 15
        BSS Transition Candidate List Entries: 341054ec2f72136c171800007970090301ff341054ec2f72260c171800007988090301ff341054ec2f725778070800005106070301ff
        Tag: Neighbor Report
            Tag Number: Neighbor Report (52)
            Tag length: 16
            BSSID: RuckusWirele_72:13:6c (54:ec:2f:72:13:6c)
            BSSID Information: 0x00001817
                .... .... .... .... .... .... .... ..11 = AP Reachability: Reachable (0x3)
                .... .... .... .... .... .... .... .1.. = Security: True
                .... .... .... .... .... .... .... 0... = Key Scope: False
                .... .... .... .... .... ..00 0001 .... = Capability: 0x01
                    .... .... .... .... .... .... ...1 .... = Spectrum Management: True
                    .... .... .... .... .... .... ..0. .... = QoS: False
                    .... .... .... .... .... .... .0.. .... = APSD: False
                    .... .... .... .... .... .... 0... .... = Radio Measurement: False
                    .... .... .... .... .... ...0 .... .... = Delayed Block Ack: False
                    .... .... .... .... .... ..0. .... .... = Immediate Block Ack: False
                .... .... .... .... .... .0.. .... .... = Mobility Domain: False
                .... .... .... .... .... 1... .... .... = High Throughput Control (+HTC): True
                .... .... .... .... ...1 .... .... .... = Very High Throughput (+VHT): True
                .... .... .... .... ..0. .... .... .... = Fine Timing Measurement (FTM): False
                .... .... .... .... .0.. .... .... .... = High Efficiency (HE AP): False
                .... .... .... .... 0... .... .... .... = Extended Range BSS: False
                .... .... .... ...0 .... .... .... .... = Co-Located AP: False
                .... .... .... ..0. .... .... .... .... = Unsolicited Probe Responses Active: False
                .... .... .... .0.. .... .... .... .... = Members Of ESS With 2.4/5 GHz Co-Located AP: False
                .... .... .... 0... .... .... .... .... = OCT Supported With Reporting AP: False
                .... .... ...0 .... .... .... .... .... = Co-Located With 6 GHz AP: False
                .... .... ..0. .... .... .... .... .... = Extremely High Throughput: False
                0000 0000 00.. .... .... .... .... .... = Reserved: 0x000
            Operating Class: 121
            Channel Number: 112 (iterative measurements on that Channel Number)
            PHY Type: 0x09
            Subelement: BSS Transition Candidate Preference
                ID: 3
                Length: 1
                Preference: 255
        Tag: Neighbor Report
        Tag: Neighbor Report

````




















# 802.11r Fast Transition


## Types of Roaming

1. Slow Roaming
2. 802.11k Assisted Roaming
3. 802.11v BSS Transition
    - 802.11k/v Assisted Roaming + BSS Transition
4. 802.11r Fast Transition
    - 802.11k/v/r  `FT` + `RRM` & `WNM`




# Resources

- https://www.youtube.com/watch?v=4Ua2lI6HBhE
- https://www.youtube.com/watch?v=p_K9xHxFM8Y
- https://www.youtube.com/watch?v=K0FJihful4A
- https://mac-wifi.com/how-to-verify-whether-802-11k-and-11r-are-enabled-via-a-capture/
- https://www.linkedin.com/posts/wi-fi-nomads_wifi-11kvr-wifinomads-activity-7235988334072737792-MkLY/?utm_source=share&utm_medium=member_android
- https://blogs.cisco.com/networking/why-the-802-11k-and-neighbor-report-are-important
- https://support.apple.com/es-lamr/guide/deployment/dep98f116c0f/web
- https://www.linkedin.com/posts/santoseva_comparing-80211k-vs-80211v-for-roaming-activity-7243993630145716225-poRO/?utm_source=share&utm_medium=member_desktop
- https://www.mist.com/documentation/802-11k-802-11r-802-11v/
- https://www.wifrizzy.com/post/is-802-11v-problematic
- https://en.wikipedia.org/wiki/IEEE_802.11k-2008
- https://en.wikipedia.org/wiki/IEEE_802.11v-2011
- https://mrncciew.com/2014/10/09/802-11-mgmt-action-frames/
- https://mrncciew.com/2014/09/02/cwsp-802-11-roaming-basics/
- https://mrncciew.com/2020/12/10/fast-roaming-lessons/
- https://www.tanaza.com/wifi-fast-roaming/
- https://www.tanaza.com/blog/load-balancing-for-network-performance/
- https://mrncciew.com/2014/09/11/cwsp-802-11k-ap-assisted-roaming/
- https://support.tanaza.com/s/article/802-11k-Assisted-roaming
- https://mrncciew.com/2014/09/11/cwsp-802-11k-ap-assisted-roaming/
- https://www.arubanetworks.com/techdocs/ArubaOS_6_5_3_X_Web_Help/Content/ArubaFrameStyles/VirtualAPs/BSS_Transition_Management_(80211v).htm
- https://wifiwiki.wordpress.com/2020/04/27/802-11v-wireless-network-management/
- https://www.mist.com/documentation/802-11k-802-11r-802-11v/
- https://www.cwnp.com/bandsteering/
- https://wifiwiki.wordpress.com/2020/04/27/802-11v-wireless-network-management/
- https://wifiwiki.wordpress.com/2019/11/04/wifi-roaming-part-1-okc/
- https://wifiwiki.wordpress.com/2020/01/28/wifi-roaming-part-2-ft/

  
---

<span align="center"> <p align="center"> ![giphy](https://user-images.githubusercontent.com/94720207/166587250-292d9a9f-e590-4c25-a678-d457e2268e85.gif) </p> </span> 



&nbsp;

<span align="center"> <p align="center"> _I hope this information was useful for someone_ </p> </span> 
<span align="center"> <p align="center"> _and please, don't forget to enjoy your days..._ </p> </span> 
<span align="center"> <p align="center"> _...It is getting dark... so dark..._ </p> </span> 

&nbsp;

<span align="center"> <p align="center"> _In the mist of the night you could see me come, where shadows move and Demons lie..._ </p> </span> 
<span align="center"> <p align="center"> _I am [Fz3r0 üíÄ](https://github.com/Fz3r0/) and the Sun no longer rises..._ </p> </span> 

---






---

> ![hecho en mexico 5](https://user-images.githubusercontent.com/94720207/166068790-fa1f243d-2db9-4810-a6e4-eb3c4ad23700.png)
>
> _- Hecho en M√©xico - by [Fz3r0 üíÄ](https://github.com/Fz3r0/)_  
>
> _"In the mist of the night you could see me come, where shadows move and Demons lie..."_ 
